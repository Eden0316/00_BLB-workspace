<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="productMapper">

	<resultMap id="productResultSet" type="product">
		<id column="PROD_NO" property="prodNo"/>
		<result column="CATEGORY_NAME" property="categoryName"/>
		<result column="SUBCATEGORY_NAME" property="subcategoryName"/>
		<result column="PROD_NAME" property="prodName"/>
		<result column="PROD_CONTENT" property="prodContent"/>
		<result column="PROD_PRICE" property="prodPrice"/>
		<result column="PROD_ORIGIN" property="prodOrigin"/>
		<result column="PROD_CAUTION" property="prodCaution"/>
		<result column="PROD_COUNT" property="prodCount"/>
		<result column="PROD_ENROLL_DATE" property="prodEnrollDate"/>
		<result column="PROD_STATUS" property="prodStatus"/>
	</resultMap>
	
	<select id="selectProductCount" parameterType="map" 
			resultType="_int">
		SELECT COUNT(*) AS COUNT
		  FROM TB_PRODUCT
		 WHERE PROD_STATUS = 'Y'
		   AND (#{category} = '전체제품' OR CATEGORY_NAME = #{category})
		   <if test="subcategories != null and subcategories.size() > 0">
	           AND SUBCATEGORY_NAME IN
	           <foreach item="subcategory" collection="subcategories" open="(" separator="," close=")">
	               #{subcategory}
	           </foreach>
	       </if>
	</select>
	
	<select id="selectProductList" parameterType="map" 
			resultMap="productResultSet">
		SELECT P.PROD_NO
		     , P.CATEGORY_NAME
		     , P.SUBCATEGORY_NAME
		     , P.PROD_NAME
		     , P.PROD_CONTENT
		     , P.PROD_PRICE
		     , P.PROD_COUNT
		     , P.PROD_ENROLL_DATE
		  FROM TB_PRODUCT P
		 WHERE P.PROD_STATUS = 'Y'
		   AND (#{category} = '전체제품' OR CATEGORY_NAME = #{category})
		   <if test="subcategories != null and subcategories.size() > 0">
	           AND SUBCATEGORY_NAME IN
	           <foreach item="subcategory" collection="subcategories" open="(" separator="," close=")">
	               #{subcategory}
	           </foreach>
	       </if>
		 ORDER BY P.PROD_NO DESC
	</select>
</mapper>
